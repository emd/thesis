\newcommand{\nom}{\text{nom}}
\newcommand{\trig}{\text{trig}}
\newcommand{\meas}{\text{meas}}


\chapter{Synchronization of digital records}
\label{app:DigitizerSynchronization}
\ldots
Efficient conversion of an analog signal to a digital record requires
quantization of the signal magnitude and
temporal sampling of these quantized magnitudes~\cite{bennett_bstj48}.


\section{Timebase of single digital record}
\label{app:DigitizerSynchronization:timebase_single_record}
Typically, temporal sampling of signal $x_j(t)$ occurs
at a fixed sampling rate $F_j$ such that
successive points in the digital record
are separated in time by $1 / F_j$.
Digitization begins at the ``trigger time'' $t_j[0]$ such that
the time corresponding to the $m\ts{th}$ digitized point is
\begin{equation}
  t_j[m] = t_j[0] + \frac{m}{F_j}.
  \label{eq:DigitizerSynchronization:timebase_generic}
\end{equation}
Ideally, the \emph{realized} sampling rate $F_j$ and trigger time $t_j[0]$
are equal to their \emph{nominal} values
$F_j^{\nom}$ and $t_j^{\nom}[0]$, respectively.
However, short-term jitter, long-term drifts, and constant offsets
often plague real-world digitization such that
$F_j \neq F_j^{\nom}$, $t_j[0] \neq t_j^{\nom}[0]$, and
\begin{equation}
  t_j[m] \neq t_j^{\nom}[0] + \frac{m}{F_j^{\nom}};
\end{equation}
that is, the actual time base of the digital record
does \emph{not} equal the nominal timebase.
In a properly operating digitizer,
these discrepancies are typically small, and
an autospectral-density estimate (for example)
of $x_j(t)$ from its digital record
will be negligibly compromised.
When estimating the \emph{phasing}
between $x_j(t)$ and $x_{k}(t)$ for $j \neq k$, however,
identifying and correcting such timebase discrepancies
becomes paramount in importance.


\section{Which digital records can be synchronized?}
\label{app:DigitizerSynchronization:digitization_schemes}
The digitization scheme determines
whether or not digital records
$\{x_j[m]\}$ and $\{x_k[m]\}$
can be synchronized.
The cleanest, simplest, and most problem-free scheme
is to digitize $x_j(t)$ and $x_k(t)$ on the \emph{same} system
such that the actual sample rates and trigger times
of both digital records are identical
(i.e.\ $F_j = F_k$ and $t_j[0] = t_k[0]$, respectively).
However, such a scheme is not always feasible.
Further, note that multiple digitizer boards
operating in a master-slave configuration
can still suffer from trigger-time offsets,
despite nominally being part of the same digitization system.
The next-best scheme is to use phase-locked digitizers
such that $F_j / F_k = F_j^{\nom} / F_k^{\nom}$,
regardless of any short-term jitter or long-term drift
in the digitizer clocks.
In general, phase-locked digitizers
still suffer from trigger offsets, which result
from the digitizers having different actual trigger times
(i.e.\ $t_j[0] \neq t_k[0]$) and
from each digitizer triggering at
an actual time that differs from its nominal trigger time
(e.g.\ $t_j[0] \neq t_j^{\nom}[0]$).
As shown in
Section~\ref{app:DigitizerSynchronization:phase_locked_synchronization},
it \emph{is} possible to synchronize records
from phase-locked digitizers.
Finally, the least-desirable scheme
is to use free-running digitizers
such that $F_j / F_k \neq F_j^{\nom} / F_k^{\nom}$;
it may be impossible to synchronize records
from free-running digitizers.


\section{Synchronization of phase-locked digital records}
\label{app:DigitizerSynchronization:phase_locked_synchronization}
\begin{itemize}
  \item Trigger offset
  \item Estimating trigger offset from constant-frequency mode
  \item Estimating trigger offset from mode with linearly ramped frequency
\end{itemize}


\subsection{The ``trigger offset''}
Phase-locked digitizers can still suffer from trigger offsets.
To see this, for digitizer $j$ define
$\delta t_j = t_j[0] - t_j^{\nom}[0]$
to be the difference between the actual and nominal trigger times,
$\delta F_j = F_j - F_j^{\nom}$
to be the difference between the actual and nominal sampling rates, and
$\bar{\delta F_j} = \delta F_j / F_j^{\nom}$
to be the relative difference between the actual and nominal sampling rates.
Then, to first order in $\bar{\delta F_j}$,
the actual digitization times $t_j[m]$
are related to the nominal digitization times $t_j^{\nom}[m]$ via
\begin{equation}
  t_j[m]
  \approx
  t_j^{\nom}[m]
  +
  \delta t_j
  -
  \frac{m \cdot \bar{\delta F_j}}{F_j^{\nom}}.
  \label{eq:DigitizerSynchronization:timebase_actual_vs_nominal}
\end{equation}
Thus, trigger-time discrepancy $\delta t_j$
produces a constant offset
between the actual and nominal timebases, while
sampling-rate discrepancy $\delta F_j$
produces a linear ramp
between the actual and nominal timebases.
Now, for phase-locked digitizers $j$ and $k$,
$\bar{\delta F_j} = \bar{\delta F_k}$
such that the corresponding ``trigger offset'' $\delta t_{\trig}$
between digital records $j$ and $k$ is
\begin{align}
  \delta t_{\trig}
  &=
  t_j[m] - t_k[m]
  \notag \\
  &=
  \left( \delta t_j - \delta t_k \right)
  +
  \bar{\delta F_j} \left( t_j^{\nom}[0] - t_k^{\nom}[0] \right).
  \label{eq:DigitizerSynchronization:trigger_offset}
\end{align}
Here, the first term on the right-hand side of
(\ref{eq:DigitizerSynchronization:trigger_offset})
corresponds to the difference between
trigger-time discrepancies of each digitizer, while
the second term on the right-hand side
corresponds to the relative sampling-rate discrepancy
weighted by the difference in nominal trigger times.
Note that (\ref{eq:DigitizerSynchronization:trigger_offset})
is valid even when $F_j^{\nom} \neq F_k^{\nom}$
(i.e.\ measurements made at different nominal sampling rates
can be upconverted or downconverted~\cite[Sec.~4.6]{oppenheim}
to the same nominal sampling rate, and
then (\ref{eq:DigitizerSynchronization:trigger_offset}) applies).


\subsection{Effect of the trigger offset}
The trigger offset (\ref{eq:DigitizerSynchronization:trigger_offset})
biases the phase of the digital record.
To see this, let $x_j(t)$ be a coherent mode
of angular frequency $\omega$ such that
the corresponding digital record is
\begin{align}
  x_j[m]
  &=
  x_j(t_j[m])
  \notag \\
  &=
  X_j(\omega) e^{-i \omega t_j[m]}
  \notag \\
  &=
  |X_j(\omega)| e^{i \{ \alpha_j(\omega) - \omega t_j[m]\}},
\end{align}
where $|X_j(\omega)|$ is the Fourier amplitude and
$\alpha_j(\omega)$ is the Fourier phase.
Then, the \emph{measured} phase difference $\Delta \alpha_{\meas}$
between digital records $\{x_j[m]\}$ and $\{x_k[m]\}$ is
\begin{align}
  \Delta \alpha_{\meas}
  &=
  \arg\left(
    x_k^*[m]
    \cdot
    x_j[m]
  \right)
  \notag \\
  &=
  \left[
    \alpha_j(\omega)
    -
    \alpha_k(\omega)
  \right]
  -
  \omega
  \left(
    t_j[m] - t_k[m]
  \right)
  \notag \\
  &=
  \Delta \alpha(\omega)
  -
  \left( \omega \cdot \delta t_{\trig} \right)
  \label{eq:DigitizerSynchronization:measured_phase_difference}
\end{align}
Thus, non-zero $\delta t_{\trig}$ biases
the measured phase difference $\Delta \alpha_{\meas}$
away from the true phase difference $\Delta \alpha$.
The above argument readily extends to broadband signals.


\subsection{Estimating the trigger offset}


\bibliographystyle{plainurl}
\bibliography{references}
